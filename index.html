<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <script>
        var canvas = document.createElement('canvas');
        canvas.width = 500;
        canvas.height = 500;
        canvas.style.border = '1px solid pink';
        document.body.appendChild(canvas);
        var ctx = canvas.getContext('2d');


        ctx.save();
        ctx.fillStyle = 'yellow';
        ctx.beginPath();
        ctx.moveTo(250, 250)
        ctx.arc(250, 250, 200, 0, Math.PI / 180 * 345);
        ctx.closePath();
        ctx.fill();
        ctx.restore();


        ctx.save();
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(350, 150, 20, 0, Math.PI / 180 * 360);
        ctx.closePath();
        ctx.fill();
        ctx.restore();



        ctx.beginPath();
        ctx.arc(360, 160, 5, 0, Math.PI / 180 * 360);
        ctx.closePath();
        ctx.fill();

        ctx.save();
        ctx.strokeStyle = '#ccc';
        ctx.lineWidth = 6;
        ctx.beginPath();
        ctx.moveTo(250, 55);
        ctx.lineTo(250, 105);
        ctx.moveTo(240, 55);
        ctx.lineTo(240, 105);
        ctx.moveTo(230, 55);
        ctx.lineTo(230, 105);
        ctx.moveTo(220, 55);
        ctx.lineTo(220, 105);
        ctx.moveTo(260, 55);
        ctx.lineTo(260, 105);
        ctx.moveTo(270, 55);
        ctx.lineTo(270, 105);
        ctx.moveTo(280, 55);
        ctx.lineTo(280, 105);
        ctx.stroke();
        ctx.restore();


        var data = [
            { value: 335, name: '直接访问', color: "rgb(213, 58, 53)" },
            { value: 310, name: '邮件营销', color: "rgb(51, 75, 92)" },
            { value: 234, name: '联盟广告', color: "rgb(106, 176, 184)" },
            { value: 135, name: '视频广告', color: "rgb(233, 143, 111)" },
            { value: 1548, name: '搜索引擎', color: "rgb(145, 199, 174)" }
        ];

        var canvas = document.createElement('canvas');
        canvas.width = 500;
        canvas.height = 500;
        canvas.style.border = '1px solid pink';
        document.body.appendChild(canvas);
        var ctx = canvas.getContext('2d');


        // var sum = data.reduce((prey, cur) => {return prey.value + cur.value})
        var everyValue = data.map(item => { return item.value });
        var sum = everyValue.reduce((prey, cur) => { return prey + cur })
        var deg = Math.PI / 180;
        var everyDeg = everyValue.map(function (item) {
            return item / sum * 360;
        });
        var startDeg = -90;




        for (var i = 0; i < data.length; i++) {
            var endDeg = everyDeg[i];
            ctx.save();
            ctx.beginPath();
            ctx.fillStyle = data[i].color;
            ctx.moveTo(250, 250);
            ctx.arc(250, 250, 200, startDeg * deg, (startDeg + endDeg) * deg);
            ctx.closePath();
            ctx.fill();
            ctx.restore();
            startDeg += endDeg;

            ctx.save();
            ctx.beginPath();
            ctx.fillStyle = data[i].color;
            ctx.rect(20, i * 20 + 10, 30, 16);
            ctx.closePath();
            ctx.fill();
            ctx.restore();


            // ctx.textAlign = 'center'
            ctx.textBaseline = 'middle'
            ctx.beginPath();
            ctx.fillText(data[i].name, 60, i * 20 + 18)

        };


        ctx.save();
        ctx.fillStyle = 'white'
        ctx.beginPath();
        ctx.arc(250, 250, 150, 0, 360 * deg);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
    </script>
</body>

</html>